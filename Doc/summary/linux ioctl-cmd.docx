
#define _IOC_NRBITS 8
#define _IOC_TYPEBITS   8
#define _IOC_SIZEBITS   13
#define _IOC_DIRBITS    3

#define _IOC_NRMASK ((1 << _IOC_NRBITS)-1)
#define _IOC_TYPEMASK   ((1 << _IOC_TYPEBITS)-1)
#define _IOC_SIZEMASK   ((1 << _IOC_SIZEBITS)-1)
#define _IOC_DIRMASK    ((1 << _IOC_DIRBITS)-1)

#define _IOC_NRSHIFT    0
#define _IOC_TYPESHIFT  (_IOC_NRSHIFT+_IOC_NRBITS)
#define _IOC_SIZESHIFT  (_IOC_TYPESHIFT+_IOC_TYPEBITS)
#define _IOC_DIRSHIFT   (_IOC_SIZESHIFT+_IOC_SIZEBITS)

#define _IOC_NONE   1U
#define _IOC_READ   2U
#define _IOC_WRITE  4U

#define _IOC(dir,type,nr,size)          \
    ((unsigned int)             \
     (((dir)  << _IOC_DIRSHIFT) |       \
      ((type) << _IOC_TYPESHIFT) |      \
      ((nr)   << _IOC_NRSHIFT) |        \
      ((size) << _IOC_SIZESHIFT)))

/* used to create numbers */
#define _IO(type,nr)        _IOC(_IOC_NONE,(type),(nr),0)
#define _IOR(type,nr,size)  _IOC(_IOC_READ,(type),(nr),sizeof(size))
#define _IOW(type,nr,size)  _IOC(_IOC_WRITE,(type),(nr),sizeof(size))
#define _IOWR(type,nr,size) _IOC(_IOC_READ|_IOC_WRITE,(type),(nr),sizeof(size))   

#define VIDIOC_S_FMT        _IOWR('V',  5, struct v4l2_format)                  
VIDIOC_S_FMT : 0xc0cc5605


============================================================
#define VIDIOC_S_FMT        _IOWR('V',  5, struct v4l2_format)                  
#define _IOWR(type,nr,size) _IOC(_IOC_READ|_IOC_WRITE,(type),(nr),sizeof(size))   
==>
#define _IOWR(type,nr,size) _IOC(_IOC_READ|_IOC_WRITE,('V'),(5),sizeof(struct v4l2_format))   
==>
#define _IOC(dir,type,nr,size)          \
    ((unsigned int)             \
     (((_IOC_READ|_IOC_WRITE)  << (_IOC_SIZESHIFT+_IOC_SIZEBITS)) |       \
      (('V') <<(_IOC_NRSHIFT+_IOC_NRBITS)) |      \
      ((5)   << 0) |        \
      ((,sizeof(struct v4l2_format)) <<(_IOC_TYPESHIFT+_IOC_TYPEBITS))))

==>

#define _IOC(dir,type,nr,size)          \
    ((unsigned int)             \
     (((_IOC_READ|_IOC_WRITE)  << (16=13)) |       \
      (('V') <<(0+8)) |      \
      ((5)   << 0) |        \
      ((,sizeof(struct v4l2_format)) <<(8+8))))


============================================================



dir
size
type
nr
3bit
13bit
8bit
8bit



